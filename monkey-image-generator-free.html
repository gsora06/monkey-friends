<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêµ Monkey Friends Gallery üêµ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #FFE066 0%, #FF6B6B 25%, #4ECDC4 50%, #5C7AFF 75%, #FFE066 100%);
            background-size: 400% 400%;
            animation: gradientMove 15s ease infinite;
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Floating shapes decoration */
        .shape {
            position: fixed;
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
        }

        .circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: #FF6B6B;
            top: 10%;
            left: 5%;
            animation: float 6s ease-in-out infinite;
        }

        .square {
            width: 120px;
            height: 120px;
            background: #5C7AFF;
            transform: rotate(45deg);
            top: 60%;
            right: 10%;
            animation: float 8s ease-in-out infinite reverse;
        }

        .triangle {
            width: 0;
            height: 0;
            border-left: 60px solid transparent;
            border-right: 60px solid transparent;
            border-bottom: 100px solid #FFE066;
            bottom: 15%;
            left: 15%;
            animation: float 7s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-30px) rotate(10deg); }
        }

        /* Sticky Header */
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 20px 0;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo {
            font-family: 'Fredoka', sans-serif;
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #FF6B6B 0%, #5C7AFF 50%, #FFE066 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .stats {
            display: flex;
            gap: 20px;
            font-weight: 600;
            color: #333;
        }

        .stat-badge {
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            font-size: 0.95em;
        }

        .stat-badge.favorites {
            background: linear-gradient(135deg, #5C7AFF, #7B94FF);
            box-shadow: 0 4px 15px rgba(92, 122, 255, 0.3);
        }

        /* Hero Section */
        .hero {
            position: relative;
            z-index: 1;
            text-align: center;
            padding: 80px 30px;
            color: white;
        }

        .hero h1 {
            font-family: 'Fredoka', sans-serif;
            font-size: 5em;
            font-weight: 700;
            text-shadow: 4px 4px 0px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            animation: bounceIn 1s ease-out;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        .hero p {
            font-size: 1.5em;
            font-weight: 600;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 40px;
        }

        /* Main Container */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px 60px;
        }

        /* Controls Section */
        .controls-section {
            background: white;
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            margin-bottom: 40px;
            border: 5px solid transparent;
            background-clip: padding-box;
            position: relative;
        }

        .controls-section::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 30px;
            padding: 5px;
            background: linear-gradient(135deg, #FF6B6B, #FFE066, #5C7AFF);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
            z-index: -1;
        }

        .section-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 2em;
            color: #333;
            margin-bottom: 25px;
            text-align: center;
        }

        .control-group {
            margin-bottom: 30px;
            position: relative;
            z-index: 10;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        select {
            width: 100%;
            padding: 15px 20px;
            border: 3px solid #5C7AFF;
            border-radius: 15px;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            z-index: 10;
        }

        select:hover {
            border-color: #FF6B6B;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(92, 122, 255, 0.3);
        }

        select:focus {
            outline: none;
            border-color: #FFE066;
            box-shadow: 0 0 0 4px rgba(255, 224, 102, 0.3);
        }

        /* Button Grid */
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        button {
            font-family: 'Fredoka', sans-serif;
            color: white;
            border: none;
            padding: 20px 30px;
            border-radius: 20px;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button:hover:not(:disabled) {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        button:active:not(:disabled) {
            transform: translateY(-2px) scale(1.02);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #FF6B6B 0%, #FF8E8E 100%);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #5C7AFF 0%, #7B94FF 100%);
        }

        .btn-tertiary {
            background: linear-gradient(135deg, #FFE066 0%, #FFD700 100%);
            color: #333;
        }

        .btn-danger {
            background: linear-gradient(135deg, #FF6B6B 0%, #C92A2A 100%);
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 60px;
            background: white;
            border-radius: 30px;
            margin: 40px 0;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .loading.hidden {
            display: none;
        }

        .loading-text {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.8em;
            color: #333;
            margin: 20px 0;
            font-weight: 600;
        }

        .spinner-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }

        .spinner-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .spinner-dot:nth-child(1) {
            background: #FF6B6B;
            animation-delay: -0.32s;
        }

        .spinner-dot:nth-child(2) {
            background: #FFE066;
            animation-delay: -0.16s;
        }

        .spinner-dot:nth-child(3) {
            background: #5C7AFF;
            animation-delay: 0s;
        }

        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #f0f0f0;
            border-radius: 20px;
            overflow: hidden;
            margin-top: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF6B6B, #FFE066, #5C7AFF);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 20px;
        }

        /* Gallery */
        .gallery-section {
            margin-top: 60px;
        }

        .gallery-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 2.5em;
            color: white;
            text-align: center;
            margin-bottom: 40px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .image-card {
            background: white;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            transition: all 0.4s ease;
            animation: cardSlideIn 0.6s ease-out;
            border: 4px solid transparent;
        }

        @keyframes cardSlideIn {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .image-card:hover {
            transform: translateY(-10px) rotate(-1deg);
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
        }

        .image-card:nth-child(3n+1) {
            border-color: #FF6B6B;
        }

        .image-card:nth-child(3n+2) {
            border-color: #FFE066;
        }

        .image-card:nth-child(3n) {
            border-color: #5C7AFF;
        }

        .image-card img {
            width: 100%;
            height: 220px;
            object-fit: cover;
            display: block;
            cursor: pointer;
            transition: transform 0.4s ease;
        }

        .image-card:hover img {
            transform: scale(1.1);
        }

        .image-info {
            padding: 10px;
            text-align: center;
        }

        .image-info h3 {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.1em;
            color: #333;
            margin-bottom: 4px;
        }

        .image-info .fun-fact {
            color: #666;
            font-size: 0.8em;
            font-style: italic;
            margin: 4px 0;
            line-height: 1.3;
        }

        .image-actions {
            display: flex;
            gap: 5px;
            padding: 8px;
            background: #f8f9fa;
            border-top: 2px solid #eee;
        }

        .action-btn {
            flex: 1;
            padding: 6px 8px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .action-btn.favorite {
            background: white;
            border: 3px solid #FFE066;
        }

        .action-btn.favorite.active {
            background: linear-gradient(135deg, #FFE066, #FFD700);
            border-color: #FFD700;
        }

        .action-btn.download {
            background: linear-gradient(135deg, #5C7AFF, #7B94FF);
            color: white;
        }

        .action-btn.share {
            background: linear-gradient(135deg, #4ECDC4, #6FE0D8);
            color: white;
        }

        .action-btn.delete {
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            color: white;
        }

        .action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            color: #333;
            padding: 20px 30px;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            z-index: 2000;
            animation: toastSlideIn 0.4s ease-out;
            font-weight: 600;
            font-size: 1.1em;
            border: 4px solid;
            min-width: 300px;
        }

        .toast.success {
            border-color: #4ECDC4;
            background: linear-gradient(135deg, #4ECDC4, #6FE0D8);
            color: white;
        }

        .toast.error {
            border-color: #FF6B6B;
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            color: white;
        }

        .toast.warning {
            border-color: #FFE066;
            background: linear-gradient(135deg, #FFE066, #FFD700);
            color: #333;
        }

        @keyframes toastSlideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(10px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            max-width: 90%;
            max-height: 90%;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: modalZoom 0.4s ease-out;
        }

        @keyframes modalZoom {
            from {
                transform: scale(0.7);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-controls {
            position: absolute;
            top: 30px;
            right: 30px;
            display: flex;
            gap: 15px;
        }

        .modal-btn {
            background: linear-gradient(135deg, #FFE066, #FFD700);
            border: none;
            color: #333;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
            font-weight: bold;
        }

        .modal-btn:hover {
            transform: scale(1.2) rotate(5deg);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .modal-btn.close-btn {
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            color: white;
        }

        .modal-btn.fullscreen-btn {
            background: linear-gradient(135deg, #5C7AFF, #7B94FF);
            color: white;
        }

        /* Favorites Section */
        .favorites-section {
            margin-top: 80px;
            padding-top: 60px;
            border-top: 5px dashed rgba(255,255,255,0.3);
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border-width: 0;
        }

        button:focus-visible,
        select:focus-visible,
        .action-btn:focus-visible {
            outline: 4px solid #FFE066;
            outline-offset: 4px;
        }

        /* Memory Game Styles */
        .game-section {
            background: white;
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            margin: 60px 0;
            border: 5px solid transparent;
            background-clip: padding-box;
            position: relative;
            display: block !important;
            visibility: visible !important;
        }

        .game-section::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 30px;
            padding: 5px;
            background: linear-gradient(135deg, #FF6B6B, #FFE066, #5C7AFF);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
            z-index: -1;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 2.5em;
            color: #333;
            margin-bottom: 15px;
        }

        .game-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .game-stat {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.3em;
            padding: 10px 25px;
            border-radius: 20px;
            font-weight: 700;
        }

        .game-stat.moves {
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            color: white;
        }

        .game-stat.matches {
            background: linear-gradient(135deg, #5C7AFF, #7B94FF);
            color: white;
        }

        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            font-family: 'Fredoka', sans-serif;
            padding: 12px 30px;
            border-radius: 15px;
            border: 3px solid #ddd;
            background: white;
            color: #333;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .difficulty-btn.active {
            background: linear-gradient(135deg, #FFE066, #FFD700);
            border-color: #FFD700;
            transform: scale(1.1);
        }

        .difficulty-btn:hover {
            transform: scale(1.05);
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            max-width: 600px;
            margin: 0 auto 30px;
            perspective: 1000px;
        }

        .game-board.easy {
            grid-template-columns: repeat(2, 1fr);
            max-width: 350px;
        }

        .game-board.medium {
            grid-template-columns: repeat(3, 1fr);
            max-width: 500px;
        }

        .memory-card {
            aspect-ratio: 1;
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }

        .memory-card.flipped {
            transform: rotateY(180deg);
        }

        .memory-card.matched {
            animation: matchPulse 0.6s ease-in-out;
            pointer-events: none;
        }

        @keyframes matchPulse {
            0%, 100% { transform: rotateY(180deg) scale(1); }
            50% { transform: rotateY(180deg) scale(1.2); }
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .card-front {
            background: linear-gradient(135deg, #5C7AFF, #7B94FF);
            font-size: 4em;
        }

        .card-back {
            background: white;
            transform: rotateY(180deg);
            overflow: hidden;
            border: 5px solid;
        }

        .card-back.red {
            border-color: #FF6B6B;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.5);
        }

        .card-back.yellow {
            border-color: #FFE066;
            box-shadow: 0 0 15px rgba(255, 224, 102, 0.5);
        }

        .card-back.blue {
            border-color: #5C7AFF;
            box-shadow: 0 0 15px rgba(92, 122, 255, 0.5);
        }

        .card-back img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .game-controls {
            text-align: center;
        }

        .game-btn {
            font-family: 'Fredoka', sans-serif;
            background: linear-gradient(135deg, #FF6B6B, #FF8E8E);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 20px;
            font-size: 1.3em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .game-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .win-message {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #FFE066, #FFD700);
            border-radius: 25px;
            margin-bottom: 20px;
            display: none;
            animation: bounceIn 0.8s ease-out;
        }

        .win-message.show {
            display: block;
        }

        .win-message h3 {
            font-family: 'Fredoka', sans-serif;
            font-size: 2.5em;
            color: #333;
            margin-bottom: 10px;
        }

        .win-message p {
            font-size: 1.3em;
            color: #666;
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 3em;
            }

            .logo {
                font-size: 2em;
            }

            .button-grid {
                grid-template-columns: 1fr;
            }

            .gallery {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            .game-board {
                gap: 10px;
            }

            .game-board.easy {
                max-width: 280px;
            }

            .game-board.medium {
                max-width: 400px;
            }
        }

        @media (max-width: 480px) {
            .gallery {
                grid-template-columns: 1fr;
            }

            .game-board.easy {
                max-width: 250px;
            }

            .card-front {
                font-size: 3em;
            }
        }
    </style>
</head>
<body>
    <!-- Decorative Shapes -->
    <div class="shape circle"></div>
    <div class="shape square"></div>
    <div class="shape triangle"></div>

    <!-- Header -->
    <header>
        <div class="header-content">
            <div class="logo">üêµ Monkey Friends</div>
            <div class="stats">
                <div class="stat-badge" id="galleryCount" role="status" aria-live="polite">
                    üì∏ Gallery: 0
                </div>
                <div class="stat-badge favorites" id="favoritesCount" role="status" aria-live="polite">
                    ‚≠ê Favorites: 0
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <h1>üêµ Welcome to Monkey Friends! üéâ</h1>
        <p>Discover amazing monkeys from around the world!</p>
    </section>

    <!-- Main Content -->
    <div class="container">
        <!-- Controls -->
        <div class="controls-section">
            <h2 class="section-title">Choose Your Monkey! üêí</h2>

            <div class="control-group">
                <label for="monkeyType">Pick a monkey species:</label>
                <select id="monkeyType" aria-label="Select monkey species">
                    <option value="monkey">üé≤ Any Monkey (Random)</option>
                    <option value="macaque">üêµ Macaque</option>
                    <option value="japanese macaque">‚ùÑÔ∏è Japanese Macaque (Snow Monkey)</option>
                    <option value="rhesus macaque">üêí Rhesus Macaque</option>
                    <option value="barbary macaque">üèîÔ∏è Barbary Macaque</option>
                    <option value="capuchin monkey">üé© Capuchin Monkey</option>
                    <option value="white faced capuchin">‚ö™ White-Faced Capuchin</option>
                    <option value="spider monkey">üï∑Ô∏è Spider Monkey</option>
                    <option value="howler monkey">üì¢ Howler Monkey</option>
                    <option value="red howler monkey">üî¥ Red Howler Monkey</option>
                    <option value="marmoset">üê≠ Marmoset</option>
                    <option value="pygmy marmoset">üå∏ Pygmy Marmoset</option>
                    <option value="tamarin">üåü Golden Tamarin</option>
                    <option value="golden lion tamarin">ü¶Å Golden Lion Tamarin</option>
                    <option value="emperor tamarin">üëë Emperor Tamarin</option>
                    <option value="proboscis monkey">üëÉ Proboscis Monkey</option>
                    <option value="squirrel monkey">üêøÔ∏è Squirrel Monkey</option>
                    <option value="vervet monkey">üåø Vervet Monkey</option>
                    <option value="baboon">üí™ Baboon</option>
                    <option value="mandrill">üé® Mandrill</option>
                    <option value="colobus monkey">‚¨õ Colobus Monkey</option>
                    <option value="black and white colobus">üñ§ Black & White Colobus</option>
                    <option value="langur">üèõÔ∏è Langur</option>
                    <option value="golden snub nosed monkey">ü•á Golden Snub-Nosed Monkey</option>
                    <option value="gelada">‚ù§Ô∏è Gelada (Bleeding Heart Monkey)</option>
                    <option value="cotton top tamarin">‚òÅÔ∏è Cotton-Top Tamarin</option>
                    <option value="night monkey">üåô Night Monkey (Owl Monkey)</option>
                    <option value="titi monkey">üíï Titi Monkey</option>
                    <option value="woolly monkey">üß∂ Woolly Monkey</option>
                    <option value="uakari">üî¥ Uakari (Bald Monkey)</option>
                    <option value="saki monkey">üé≠ Saki Monkey</option>
                    <option value="patas monkey">üèÉ Patas Monkey</option>
                    <option value="allen swamp monkey">üåä Allen's Swamp Monkey</option>
                    <option value="guenon">üåà Guenon</option>
                </select>
            </div>

            <div class="button-grid">
                <button id="loadSingleBtn" class="btn-primary" aria-label="Load one monkey image">
                    üêµ Show Me a Monkey!
                </button>
                <button id="loadMultipleBtn" class="btn-secondary" aria-label="Load six random monkey images">
                    ‚ú® Show 6 Monkeys!
                </button>
                <button id="loadCollectionBtn" class="btn-secondary" aria-label="Load macaque collection">
                    üé® Macaque Party! (5)
                </button>
                <button id="clearGalleryBtn" class="btn-danger" aria-label="Clear all images from gallery">
                    üóëÔ∏è Clear All
                </button>
            </div>
        </div>

        <!-- Loading State -->
        <div class="loading hidden" id="loadingMessage" role="alert" aria-live="polite">
            <div class="spinner-container">
                <div class="spinner-dot"></div>
                <div class="spinner-dot"></div>
                <div class="spinner-dot"></div>
            </div>
            <div class="loading-text" id="loadingText">Loading monkey photos...</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <!-- Gallery -->
        <section class="gallery-section">
            <h2 class="gallery-title">üé™ Monkey Gallery</h2>
            <div class="gallery" id="gallery" role="list" aria-label="Monkey photo gallery"></div>
        </section>

        <!-- Memory Game -->
        <section class="game-section" style="position: relative; z-index: 10;">
            <div class="game-header">
                <h2 class="game-title">üéÆ Monkey Memory Game! üêµ</h2>
                <p style="font-size: 1.2em; color: #666; margin-bottom: 10px;">Find the matching monkey pairs!</p>
                <p style="font-size: 0.95em; color: #999; margin-bottom: 20px; font-style: italic;">
                    üí° Tip: The game uses photos from your gallery above!
                </p>

                <div class="difficulty-selector">
                    <button class="difficulty-btn active" data-level="easy">
                        üåü Easy (4 cards)
                    </button>
                    <button class="difficulty-btn" data-level="medium">
                        ‚≠ê Medium (6 cards)
                    </button>
                    <button class="difficulty-btn" data-level="hard">
                        üèÜ Hard (12 cards)
                    </button>
                </div>

                <div class="game-stats">
                    <div class="game-stat moves">
                        üëÜ Moves: <span id="moveCount">0</span>
                    </div>
                    <div class="game-stat matches">
                        ‚ú® Matches: <span id="matchCount">0</span>
                    </div>
                </div>
            </div>

            <div class="win-message" id="winMessage">
                <h3>üéâ Amazing! You found them all! üéâ</h3>
                <p>You did it in <span id="finalMoves">0</span> moves! Great job! üåü</p>
            </div>

            <div class="game-board easy" id="gameBoard">
                <!-- Cards will be generated by JavaScript -->
            </div>

            <div class="game-controls">
                <button class="game-btn" id="newGameBtn">
                    üîÑ New Game
                </button>
            </div>
        </section>

        <!-- Favorites -->
        <section class="favorites-section" id="favoritesSection" style="display: none;">
            <h2 class="gallery-title">‚≠ê Your Favorite Monkeys</h2>
            <div class="gallery" id="favoritesGallery" role="list" aria-label="Favorite monkey photos"></div>
        </section>
    </div>

    <!-- Modal -->
    <div id="imageModal" class="modal" role="dialog" aria-modal="true" aria-label="Full size image viewer">
        <div class="modal-controls">
            <button class="modal-btn fullscreen-btn" id="fullscreenBtn" aria-label="Toggle fullscreen" title="Fullscreen">
                ‚õ∂
            </button>
            <button class="modal-btn close-btn" id="closeModalBtn" aria-label="Close modal" title="Close">
                √ó
            </button>
        </div>
        <img class="modal-content" id="modalImage" alt="Full size monkey photo">
    </div>

    <script>
        // Configuration
        const CONFIG = {
            unsplashKey: '_DEMO_KEY_',
            pixabayKey: '9656065-a4094594c34f9ac14c7fc4c39',
            requestDelay: 300
        };

        const monkeyFacts = {
            'macaque': [
                'Macaques are very intelligent and can learn tricks!',
                'There are 23 different species of macaques',
                'Macaques love to play in groups',
                'Some macaques have cheek pouches to store food'
            ],
            'japanese macaque': [
                'Snow monkeys love to bathe in hot springs!',
                'They have the thickest fur of all monkeys',
                'They live in the coldest climate of any monkey',
                'Baby snow monkeys are born in spring'
            ],
            'rhesus macaque': [
                'Rhesus macaques are excellent swimmers',
                'They can recognize themselves in mirrors',
                'They live in large family groups',
                'They help scientists learn about health'
            ],
            'barbary macaque': [
                'Barbary macaques live in the mountains of Morocco',
                'They are the only wild monkeys in Europe!',
                'Males help take care of babies',
                'They love to play in the snow'
            ],
            'capuchin monkey': [
                'Capuchins are one of the smartest monkeys',
                'They use tools to crack nuts',
                'They have very expressive faces',
                'Baby capuchins cling to their mothers'
            ],
            'white faced capuchin': [
                'White-faced capuchins have distinctive white fur',
                'They are very social and playful',
                'They can live up to 54 years!',
                'They love to swim and play in water'
            ],
            'spider monkey': [
                'Spider monkeys have very long arms',
                'Their tail works like an extra hand',
                'They swing from tree to tree',
                'They rarely come down to the ground'
            ],
            'howler monkey': [
                'Howler monkeys are the loudest land animal!',
                'You can hear them from 3 miles away',
                'They howl to talk to other groups',
                'They eat mostly leaves and fruit'
            ],
            'red howler monkey': [
                'Red howlers have beautiful reddish fur',
                'Males howl to protect their territory',
                'They spend most of their time in trees',
                'They can live up to 20 years'
            ],
            'marmoset': [
                'Marmosets are tiny - they fit in your hand!',
                'They have special claws for climbing',
                'Twin babies are common for marmosets',
                'They communicate with high-pitched calls'
            ],
            'pygmy marmoset': [
                'Pygmy marmosets are the smallest monkeys!',
                'They weigh less than an apple',
                'They can jump 15 feet between trees',
                'They love to eat tree sap'
            ],
            'tamarin': [
                'Golden tamarins have beautiful orange fur',
                'They are very rare and precious',
                'They live in the rainforest',
                'Dads help take care of the babies'
            ],
            'golden lion tamarin': [
                'Golden lion tamarins are bright orange!',
                'They have beautiful lion-like manes',
                'They are endangered and very special',
                'They live only in Brazil'
            ],
            'emperor tamarin': [
                'Emperor tamarins have amazing mustaches!',
                'Their mustache looks like an emperor',
                'They are very small and cute',
                'They live in family groups'
            ],
            'proboscis monkey': [
                'Male proboscis monkeys have very big noses!',
                'They are excellent swimmers',
                'They live near rivers in Borneo',
                'Their big nose helps them make loud calls'
            ],
            'squirrel monkey': [
                'Squirrel monkeys are small and super active!',
                'They live in groups of up to 500 monkeys',
                'They have yellow and gray fur',
                'Baby squirrel monkeys ride on their mothers'
            ],
            'vervet monkey': [
                'Vervet monkeys have black faces and hands',
                'They make different alarm calls for different dangers',
                'They live in African savannas',
                'They are very intelligent'
            ],
            'baboon': [
                'Baboons are large and strong monkeys',
                'They walk on all four legs like dogs',
                'They live in big family groups called troops',
                'Baboons are very smart and curious'
            ],
            'mandrill': [
                'Mandrills are the most colorful monkeys!',
                'Males have bright blue and red faces',
                'They are the largest monkeys in the world',
                'They live in African rainforests'
            ],
            'colobus monkey': [
                'Colobus monkeys have beautiful long fur',
                'They can jump up to 50 feet between trees!',
                'Baby colobus are born all white',
                'They eat mostly leaves'
            ],
            'black and white colobus': [
                'Black and white colobus look like little skunks!',
                'They have long flowing white tails',
                'They live in African forests',
                'Babies hold on tight to their mothers'
            ],
            'langur': [
                'Langurs have long tails and graceful bodies',
                'They are sacred in many cultures',
                'They can leap great distances',
                'Baby langurs are bright orange!'
            ],
            'golden snub nosed monkey': [
                'Golden snub-nosed monkeys live in snowy mountains',
                'They have beautiful golden-orange fur',
                'They have tiny upturned noses',
                'They live in China at high altitudes'
            ],
            'gelada': [
                'Geladas have heart-shaped red chests!',
                'They are called "bleeding heart monkeys"',
                'They live only in Ethiopian highlands',
                'They are the only grass-eating monkeys'
            ],
            'cotton top tamarin': [
                'Cotton-top tamarins have fluffy white hair!',
                'Their hair looks like cotton candy',
                'They are very small and endangered',
                'They live in Colombia'
            ],
            'night monkey': [
                'Night monkeys are the only nocturnal monkeys!',
                'They have huge eyes for seeing at night',
                'They sleep during the day',
                'Also called owl monkeys'
            ],
            'titi monkey': [
                'Titi monkeys are very romantic!',
                'Mated pairs sit with tails intertwined',
                'They mate for life',
                'They sing duets to each other'
            ],
            'woolly monkey': [
                'Woolly monkeys have thick, soft fur',
                'Their fur feels like wool',
                'They use their tail like a fifth hand',
                'They live in Amazon rainforests'
            ],
            'uakari': [
                'Uakaris have bright red bald heads!',
                'The redder their face, the healthier they are',
                'They live in flooded Amazon forests',
                'They are excellent swimmers'
            ],
            'saki monkey': [
                'Saki monkeys have long, shaggy fur',
                'They can jump up to 30 feet!',
                'Males often have black fur, females brown',
                'They eat mostly fruit and seeds'
            ],
            'patas monkey': [
                'Patas monkeys are the fastest primates!',
                'They can run up to 34 mph',
                'They are called "military monkeys"',
                'They live in African grasslands'
            ],
            'allen swamp monkey': [
                'Allen\'s swamp monkeys love water!',
                'They have webbed feet for swimming',
                'They live in swampy forests',
                'They are excellent swimmers'
            ],
            'guenon': [
                'Guenons are small, colorful monkeys',
                'There are many different species',
                'They have beautiful facial markings',
                'They live in African forests'
            ],
            'monkey': [
                'Monkeys love bananas and other fruits!',
                'Baby monkeys love to play and climb',
                'Monkeys groom each other to stay clean',
                'There are over 260 species of monkeys'
            ]
        };

        let imageCount = 0;
        let favoriteCount = 0;
        let usedImageIds = new Set();
        let isLoading = false;
        let imageCache = new Map();
        let favorites = new Set();

        function loadFavorites() {
            try {
                const saved = localStorage.getItem('monkeyFavorites');
                if (saved) {
                    favorites = new Set(JSON.parse(saved));
                }
            } catch (e) {
                console.error('Failed to load favorites:', e);
            }
        }

        function saveFavorites() {
            try {
                localStorage.setItem('monkeyFavorites', JSON.stringify([...favorites]));
            } catch (e) {
                console.error('Failed to save favorites:', e);
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'polite');
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'toastSlideIn 0.4s ease-out reverse';
                setTimeout(() => toast.remove(), 400);
            }, 3000);
        }

        function showLoading(show, text = 'Loading monkey photos...') {
            const loadingDiv = document.getElementById('loadingMessage');
            const loadingText = document.getElementById('loadingText');
            loadingText.textContent = text;

            if (show) {
                loadingDiv.classList.remove('hidden');
            } else {
                loadingDiv.classList.add('hidden');
                updateProgress(0);
            }
        }

        function updateProgress(percent) {
            document.getElementById('progressFill').style.width = `${percent}%`;
        }

        function updateCounter() {
            const galleryImages = document.querySelectorAll('#gallery .image-card').length;
            favoriteCount = favorites.size;
            imageCount = galleryImages;

            document.getElementById('galleryCount').textContent = `üì∏ Gallery: ${imageCount}`;
            document.getElementById('favoritesCount').textContent = `‚≠ê Favorites: ${favoriteCount}`;

            const favSection = document.getElementById('favoritesSection');
            if (favoriteCount > 0) {
                favSection.style.display = 'block';
            } else {
                favSection.style.display = 'none';
            }
        }

        function getRandomFact(monkeyType) {
            const facts = monkeyFacts[monkeyType] || monkeyFacts['monkey'];
            return facts[Math.floor(Math.random() * facts.length)];
        }

        async function fetchWithRetry(url, retries = 2) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url);
                    if (response.ok) {
                        return await response.json();
                    } else {
                        console.warn(`Fetch attempt ${i + 1} failed with status ${response.status}`);
                        if (i === retries - 1) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                    }
                } catch (error) {
                    console.error(`Fetch attempt ${i + 1} error:`, error);
                    if (i === retries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }
            throw new Error('Failed after retries');
        }

        async function fallbackToPicsumWithMonkeyQuery(monkeyType, displayName) {
            try {
                const randomId = Math.floor(Math.random() * 1000);
                const imageUrl = `https://picsum.photos/600/400?random=${randomId}`;

                addImageToGallery({
                    id: `picsum-${randomId}`,
                    url: imageUrl,
                    fullUrl: imageUrl,
                    displayName: displayName,
                    monkeyType: monkeyType,
                    photographer: 'Lorem Picsum',
                    source: 'picsum',
                    sourceUrl: 'https://picsum.photos'
                });
                showToast('‚ö†Ô∏è Loaded placeholder image (API keys may need updating)', 'warning');
                return true;
            } catch (error) {
                console.error('Even Picsum failed:', error);
                return false;
            }
        }

        async function loadMonkeyImage(skipLoadingCheck = false, autoClear = false, forceType = null, forceDisplayName = null) {
            if (!skipLoadingCheck && isLoading) {
                showToast('Please wait for current operation to complete', 'warning');
                return;
            }

            // Use forced type if provided (for collections), otherwise read from dropdown
            const monkeyType = forceType || document.getElementById('monkeyType').value;
            const displayName = forceDisplayName || document.getElementById('monkeyType').selectedOptions[0].text;

            if (!skipLoadingCheck) {
                // Auto-clear gallery when loading new images
                if (autoClear) {
                    clearGalleryWithoutConfirm();
                }
                isLoading = true;
                showLoading(true);
            }

            let imageLoaded = false;

            try {
                const randomPage = Math.floor(Math.random() * 5) + 1;
                const unsplashUrl = `https://api.unsplash.com/search/photos?query=${encodeURIComponent(monkeyType)}&page=${randomPage}&per_page=30&client_id=${CONFIG.unsplashKey}`;

                try {
                    const data = await fetchWithRetry(unsplashUrl);

                    if (data.results && data.results.length > 0) {
                        const availablePhotos = data.results.filter(photo => !usedImageIds.has(photo.id));

                        if (availablePhotos.length > 0) {
                            const photo = availablePhotos[Math.floor(Math.random() * availablePhotos.length)];
                            usedImageIds.add(photo.id);
                            addImageToGallery({
                                id: photo.id,
                                url: photo.urls.regular,
                                fullUrl: photo.urls.full,
                                displayName: displayName,
                                monkeyType: monkeyType,
                                photographer: photo.user.name,
                                source: 'unsplash',
                                sourceUrl: photo.links.html
                            });
                            imageLoaded = true;
                        }
                    }
                } catch (unsplashError) {
                    console.warn('Unsplash failed, trying Pixabay:', unsplashError);
                }

                if (!imageLoaded) {
                    const success = await fallbackToPixabay(monkeyType, displayName);
                    if (success) {
                        imageLoaded = true;
                    }
                }

                if (!imageLoaded) {
                    console.warn('Both Unsplash and Pixabay failed, using placeholder');
                    const success = await fallbackToPicsumWithMonkeyQuery(monkeyType, displayName);
                    if (success) {
                        imageLoaded = true;
                    }
                }

                if (!imageLoaded) {
                    showToast('Failed to load any images. Check console for details.', 'error');
                }
            } catch (error) {
                console.error('Error loading image:', error);
                if (!skipLoadingCheck) {
                    showToast('Failed to load image. Please try again.', 'error');
                }
            } finally {
                if (!skipLoadingCheck) {
                    isLoading = false;
                    showLoading(false);
                }
            }

            return imageLoaded;
        }

        async function fallbackToPixabay(monkeyType, displayName) {
            try {
                const query = monkeyType === 'monkey' ? 'primate' : monkeyType;
                const pixabayUrl = `https://pixabay.com/api/?key=${CONFIG.pixabayKey}&q=${encodeURIComponent(query)}&image_type=photo&per_page=200`;

                const data = await fetchWithRetry(pixabayUrl);

                if (data.hits && data.hits.length > 0) {
                    const photo = data.hits[Math.floor(Math.random() * data.hits.length)];
                    addImageToGallery({
                        id: `pixabay-${photo.id}`,
                        url: photo.largeImageURL,
                        fullUrl: photo.largeImageURL,
                        displayName: displayName,
                        monkeyType: monkeyType,
                        photographer: photo.user,
                        source: 'pixabay',
                        sourceUrl: photo.pageURL
                    });
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Pixabay fallback failed:', error);
                return false;
            }
        }

        async function loadMultipleImages(types, collectionName) {
            if (isLoading) {
                showToast('Please wait for current operation to complete', 'warning');
                return;
            }

            // Auto-clear gallery when loading new collection
            clearGalleryWithoutConfirm();

            isLoading = true;
            showLoading(true, `Loading ${collectionName}...`);

            const select = document.getElementById('monkeyType');
            let loaded = 0;

            try {
                const promises = types.map((type, index) =>
                    new Promise(async (resolve) => {
                        await new Promise(r => setTimeout(r, index * CONFIG.requestDelay));

                        // Find the display name for this type
                        let displayName = type;
                        for (let j = 0; j < select.options.length; j++) {
                            if (select.options[j].value === type) {
                                displayName = select.options[j].text;
                                break;
                            }
                        }

                        try {
                            // Pass the type directly without changing the dropdown
                            const success = await loadMonkeyImage(true, false, type, displayName);
                            if (success) {
                                loaded++;
                            }
                            updateProgress((loaded / types.length) * 100);
                        } catch (error) {
                            console.error('Failed to load image:', error);
                        }
                        resolve();
                    })
                );

                await Promise.all(promises);
                // Dropdown is never touched, so user's selection is preserved
            } catch (error) {
                console.error('Error loading collection:', error);
                showToast('Some images failed to load', 'warning');
            } finally {
                isLoading = false;
                showLoading(false);
            }
        }

        async function loadMultipleMonkeys() {
            const types = [
                'macaque',
                'japanese macaque',
                'capuchin monkey',
                'spider monkey',
                'marmoset',
                'monkey'
            ];
            await loadMultipleImages(types, '6 Random Monkeys');
        }

        async function loadMacaqueCollection() {
            const types = [
                'macaque',
                'japanese macaque',
                'rhesus macaque',
                'macaque',
                'japanese macaque'
            ];
            await loadMultipleImages(types, 'Macaque Collection');
        }

        function addImageToGallery(imageData) {
            const gallery = document.getElementById('gallery');
            const card = document.createElement('div');
            card.className = 'image-card';
            card.setAttribute('role', 'listitem');
            card.dataset.imageId = imageData.id;

            const fact = getRandomFact(imageData.monkeyType);
            const isFavorite = favorites.has(imageData.id);

            imageCache.set(imageData.id, imageData);

            card.innerHTML = `
                <img src="${imageData.url}"
                     alt="${imageData.displayName} photographed by ${imageData.photographer}"
                     data-full="${imageData.fullUrl}"
                     tabindex="0"
                     role="button"
                     aria-label="View full size ${imageData.displayName} photo">
                <div class="image-info">
                    <h3>${imageData.displayName}</h3>
                    <div class="fun-fact">${fact}</div>
                    <div style="font-size: 0.7em; color: #aaa; margin-top: 3px;">
                        üì∏ ${imageData.photographer}
                    </div>
                </div>
                <div class="image-actions">
                    <button class="action-btn favorite ${isFavorite ? 'active' : ''}"
                            data-id="${imageData.id}"
                            aria-label="${isFavorite ? 'Remove from favorites' : 'Add to favorites'}"
                            title="${isFavorite ? 'Remove from favorites' : 'Add to favorites'}">
                        ${isFavorite ? '‚òÖ' : '‚òÜ'}
                    </button>
                    <button class="action-btn download"
                            data-url="${imageData.url}"
                            aria-label="Download image"
                            title="Download">
                        ‚¨á
                    </button>
                    <button class="action-btn share"
                            data-url="${imageData.sourceUrl}"
                            aria-label="Share image"
                            title="Share">
                        ‚§¥
                    </button>
                    <button class="action-btn delete"
                            data-id="${imageData.id}"
                            aria-label="Delete image"
                            title="Delete">
                        üóë
                    </button>
                </div>
            `;

            const img = card.querySelector('img');
            img.addEventListener('click', () => openModal(imageData.fullUrl, imageData.displayName));
            img.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    openModal(imageData.fullUrl, imageData.displayName);
                }
            });

            const favoriteBtn = card.querySelector('.favorite');
            favoriteBtn.addEventListener('click', () => toggleFavorite(imageData.id));

            const downloadBtn = card.querySelector('.download');
            downloadBtn.addEventListener('click', () => downloadImage(imageData.url, imageData.displayName));

            const shareBtn = card.querySelector('.share');
            shareBtn.addEventListener('click', () => shareImage(imageData));

            const deleteBtn = card.querySelector('.delete');
            deleteBtn.addEventListener('click', () => deleteImage(imageData.id));

            gallery.insertBefore(card, gallery.firstChild);
            imageCount++;
            updateCounter();
        }

        function toggleFavorite(imageId) {
            if (favorites.has(imageId)) {
                favorites.delete(imageId);
                showToast('üíî Removed from favorites', 'success');
            } else {
                favorites.add(imageId);
                showToast('‚≠ê Added to favorites!', 'success');
            }

            saveFavorites();
            updateFavoriteButtons();
            updateFavoritesGallery();
            updateCounter();
        }

        function updateFavoriteButtons() {
            document.querySelectorAll('.favorite').forEach(btn => {
                const imageId = btn.dataset.id;
                const isFavorite = favorites.has(imageId);
                btn.classList.toggle('active', isFavorite);
                btn.textContent = isFavorite ? '‚òÖ' : '‚òÜ';
                btn.setAttribute('aria-label', isFavorite ? 'Remove from favorites' : 'Add to favorites');
            });
        }

        function updateFavoritesGallery() {
            const favGallery = document.getElementById('favoritesGallery');
            favGallery.innerHTML = '';

            if (favorites.size === 0) {
                updateCounter();
                return;
            }

            favorites.forEach(imageId => {
                const imageData = imageCache.get(imageId);
                if (imageData) {
                    const card = createFavoriteCard(imageData);
                    favGallery.appendChild(card);
                }
            });

            updateCounter();
        }

        function createFavoriteCard(imageData) {
            const card = document.createElement('div');
            card.className = 'image-card';
            card.setAttribute('role', 'listitem');

            const fact = getRandomFact(imageData.monkeyType);

            card.innerHTML = `
                <img src="${imageData.url}"
                     alt="${imageData.displayName} photographed by ${imageData.photographer}"
                     data-full="${imageData.fullUrl}"
                     tabindex="0"
                     role="button"
                     aria-label="View full size ${imageData.displayName} photo">
                <div class="image-info">
                    <h3>${imageData.displayName}</h3>
                    <div class="fun-fact">${fact}</div>
                    <div style="font-size: 0.7em; color: #aaa; margin-top: 3px;">
                        üì∏ ${imageData.photographer}
                    </div>
                </div>
                <div class="image-actions">
                    <button class="action-btn favorite active"
                            data-id="${imageData.id}"
                            aria-label="Remove from favorites"
                            title="Remove from favorites">
                        ‚òÖ
                    </button>
                    <button class="action-btn download"
                            data-url="${imageData.url}"
                            aria-label="Download image"
                            title="Download">
                        ‚¨á
                    </button>
                    <button class="action-btn share"
                            data-url="${imageData.sourceUrl}"
                            aria-label="Share image"
                            title="Share">
                        ‚§¥
                    </button>
                </div>
            `;

            const img = card.querySelector('img');
            img.addEventListener('click', () => openModal(imageData.fullUrl, imageData.displayName));
            img.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    openModal(imageData.fullUrl, imageData.displayName);
                }
            });

            const favoriteBtn = card.querySelector('.favorite');
            favoriteBtn.addEventListener('click', () => toggleFavorite(imageData.id));

            const downloadBtn = card.querySelector('.download');
            downloadBtn.addEventListener('click', () => downloadImage(imageData.url, imageData.displayName));

            const shareBtn = card.querySelector('.share');
            shareBtn.addEventListener('click', () => shareImage(imageData));

            return card;
        }

        async function downloadImage(url, name) {
            try {
                const response = await fetch(url);
                const blob = await response.blob();
                const blobUrl = window.URL.createObjectURL(blob);

                const link = document.createElement('a');
                link.href = blobUrl;
                link.download = `${name.replace(/\s+/g, '-').toLowerCase()}-${Date.now()}.jpg`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                window.URL.revokeObjectURL(blobUrl);
                showToast('‚¨áÔ∏è Download started!', 'success');
            } catch (error) {
                console.error('Download failed:', error);
                showToast('Download failed. Please try again.', 'error');
            }
        }

        async function shareImage(imageData) {
            const shareData = {
                title: `${imageData.displayName} Photo`,
                text: `Check out this amazing ${imageData.displayName} photo!`,
                url: imageData.sourceUrl
            };

            try {
                if (navigator.share) {
                    await navigator.share(shareData);
                    showToast('‚úÖ Shared successfully!', 'success');
                } else {
                    await navigator.clipboard.writeText(imageData.sourceUrl);
                    showToast('üìã Link copied to clipboard!', 'success');
                }
            } catch (error) {
                if (error.name !== 'AbortError') {
                    console.error('Share failed:', error);
                    showToast('Link copied to clipboard.', 'warning');
                    try {
                        await navigator.clipboard.writeText(imageData.sourceUrl);
                    } catch (e) {
                        console.error('Clipboard failed:', e);
                    }
                }
            }
        }

        function deleteImage(imageId) {
            const cards = document.querySelectorAll(`.image-card[data-image-id="${imageId}"]`);
            cards.forEach(card => {
                card.style.animation = 'cardSlideIn 0.3s ease-out reverse';
                setTimeout(() => {
                    card.remove();
                    imageCount--;
                    updateCounter();
                }, 300);
            });

            if (favorites.has(imageId)) {
                favorites.delete(imageId);
                saveFavorites();
                updateFavoritesGallery();
            }

            showToast('üóëÔ∏è Image deleted', 'success');
        }

        function clearGalleryWithoutConfirm() {
            if (imageCount > 0) {
                document.getElementById('gallery').innerHTML = '';
                imageCount = 0;
                usedImageIds.clear();
                updateCounter();
            }
        }

        function clearGallery() {
            if (imageCount === 0) {
                showToast('Gallery is already empty', 'warning');
                return;
            }

            if (confirm(`Clear all ${imageCount} monkey photos?`)) {
                clearGalleryWithoutConfirm();
                showToast('‚ú® Gallery cleared', 'success');
            }
        }

        function openModal(src, altText) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modal.classList.add('active');
            modalImg.src = src;
            modalImg.alt = `Full size ${altText}`;
            document.body.style.overflow = 'hidden';

            document.getElementById('closeModalBtn').focus();
        }

        function closeModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';

            if (document.fullscreenElement) {
                document.exitFullscreen();
            }
        }

        function toggleFullscreen() {
            const modal = document.getElementById('imageModal');

            if (!document.fullscreenElement) {
                modal.requestFullscreen().catch(err => {
                    showToast('Fullscreen failed', 'error');
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Add change listener to dropdown for debugging
        document.getElementById('monkeyType').addEventListener('change', function() {
            console.log('Dropdown changed to:', this.value, this.selectedOptions[0].text);
        });

        document.getElementById('loadSingleBtn').addEventListener('click', () => {
            const selectedType = document.getElementById('monkeyType').value;
            const selectedName = document.getElementById('monkeyType').selectedOptions[0].text;
            console.log('Loading monkey type:', selectedType, '(' + selectedName + ')');
            loadMonkeyImage(false, true);
        });
        document.getElementById('loadMultipleBtn').addEventListener('click', loadMultipleMonkeys);
        document.getElementById('loadCollectionBtn').addEventListener('click', loadMacaqueCollection);
        document.getElementById('clearGalleryBtn').addEventListener('click', clearGallery);

        document.getElementById('imageModal').addEventListener('click', (e) => {
            if (e.target.id === 'imageModal') {
                closeModal();
            }
        });

        document.getElementById('closeModalBtn').addEventListener('click', (e) => {
            e.stopPropagation();
            closeModal();
        });

        document.getElementById('fullscreenBtn').addEventListener('click', (e) => {
            e.stopPropagation();
            toggleFullscreen();
        });

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });

        // ===== MEMORY GAME CODE =====

        const gameState = {
            cards: [],
            flippedCards: [],
            matchedPairs: 0,
            moves: 0,
            difficulty: 'easy',
            canFlip: true,
            gameImages: []
        };

        const cardColors = ['red', 'yellow', 'blue'];

        function initMemoryGame() {
            const difficultyBtns = document.querySelectorAll('.difficulty-btn');
            difficultyBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    difficultyBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    gameState.difficulty = btn.dataset.level;
                    startNewGame();
                });
            });

            document.getElementById('newGameBtn').addEventListener('click', startNewGame);
            startNewGame();
        }

        async function loadGameImages(numPairs) {
            // Load monkey images for the game
            gameState.gameImages = [];

            // First, try to use images from the image cache if available
            const cachedImages = Array.from(imageCache.values());

            if (cachedImages.length >= numPairs) {
                // Use cached monkey images
                const selectedImages = shuffleArray(cachedImages).slice(0, numPairs);
                gameState.gameImages = selectedImages.map(img => ({
                    url: img.url,
                    type: img.monkeyType
                }));
                return;
            }

            // If not enough cached images, load new monkey photos
            const monkeyTypes = ['monkey', 'macaque', 'capuchin', 'tamarin', 'baboon', 'marmoset'];

            for (let i = 0; i < numPairs; i++) {
                const monkeyType = monkeyTypes[i % monkeyTypes.length];

                try {
                    // Try Pixabay first (more reliable)
                    const pixabayUrl = `https://pixabay.com/api/?key=${CONFIG.pixabayKey}&q=${encodeURIComponent(monkeyType)}&image_type=photo&per_page=50`;
                    const response = await fetch(pixabayUrl);

                    if (response.ok) {
                        const data = await response.json();
                        if (data.hits && data.hits.length > 0) {
                            const randomIndex = Math.floor(Math.random() * Math.min(data.hits.length, 10));
                            const photo = data.hits[randomIndex];
                            gameState.gameImages.push({
                                url: photo.webformatURL,
                                type: monkeyType
                            });
                            continue;
                        }
                    }
                } catch (error) {
                    console.error('Failed to load from Pixabay:', error);
                }

                // Fallback: try Unsplash
                try {
                    const unsplashUrl = `https://api.unsplash.com/search/photos?query=${encodeURIComponent(monkeyType)}&page=1&per_page=20&client_id=${CONFIG.unsplashKey}`;
                    const response = await fetch(unsplashUrl);

                    if (response.ok) {
                        const data = await response.json();
                        if (data.results && data.results.length > 0) {
                            const randomIndex = Math.floor(Math.random() * Math.min(data.results.length, 10));
                            const photo = data.results[randomIndex];
                            gameState.gameImages.push({
                                url: photo.urls.small,
                                type: monkeyType
                            });
                            continue;
                        }
                    }
                } catch (error) {
                    console.error('Failed to load from Unsplash:', error);
                }

                // Last resort: use a generic monkey search with different query
                gameState.gameImages.push({
                    url: `https://source.unsplash.com/300x300/?monkey,primate,${Date.now() + i}`,
                    type: monkeyType
                });
            }
        }

        async function startNewGame() {
            gameState.flippedCards = [];
            gameState.matchedPairs = 0;
            gameState.moves = 0;
            gameState.canFlip = true;

            document.getElementById('moveCount').textContent = '0';
            document.getElementById('matchCount').textContent = '0';
            document.getElementById('winMessage').classList.remove('show');

            const numPairs = gameState.difficulty === 'easy' ? 2 :
                           gameState.difficulty === 'medium' ? 3 : 6;

            // Show loading indicator
            const cachedCount = imageCache.size;
            const loadingMessage = cachedCount >= numPairs
                ? 'Getting your monkey photos... üêµ'
                : 'Loading fresh monkey photos... üêµ';
            document.getElementById('gameBoard').innerHTML = `<div style="text-align: center; padding: 40px; font-size: 1.3em; color: #666;">${loadingMessage}<div style="margin-top: 20px;" class="spinner-container"><div class="spinner-dot"></div><div class="spinner-dot"></div><div class="spinner-dot"></div></div></div>`;

            await loadGameImages(numPairs);
            createGameBoard(numPairs);
        }

        function createGameBoard(numPairs) {
            const gameBoard = document.getElementById('gameBoard');
            gameBoard.className = `game-board ${gameState.difficulty}`;
            gameBoard.innerHTML = '';

            // Create pairs using loaded images
            const imagePairs = [];
            gameState.gameImages.forEach((img, idx) => {
                imagePairs.push({ imageIndex: idx, imageUrl: img.url });
                imagePairs.push({ imageIndex: idx, imageUrl: img.url });
            });

            gameState.cards = shuffleArray(imagePairs).map((imgData, index) => ({
                id: index,
                imageIndex: imgData.imageIndex,
                imageUrl: imgData.imageUrl,
                color: cardColors[imgData.imageIndex % cardColors.length],
                isFlipped: false,
                isMatched: false
            }));

            // Render cards
            gameState.cards.forEach(card => {
                const cardElement = createCardElement(card);
                gameBoard.appendChild(cardElement);
            });
        }

        function createCardElement(card) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'memory-card';
            cardDiv.dataset.cardId = card.id;

            cardDiv.innerHTML = `
                <div class="card-face card-front">
                    üêµ
                </div>
                <div class="card-face card-back ${card.color}">
                    <img src="${card.imageUrl}" alt="Monkey" style="width: 100%; height: 100%; object-fit: cover;">
                </div>
            `;

            cardDiv.addEventListener('click', () => handleCardClick(card.id));

            return cardDiv;
        }

        function handleCardClick(cardId) {
            if (!gameState.canFlip) return;

            const card = gameState.cards.find(c => c.id === cardId);
            if (!card || card.isFlipped || card.isMatched) return;

            // Flip the card
            card.isFlipped = true;
            const cardElement = document.querySelector(`[data-card-id="${cardId}"]`);
            cardElement.classList.add('flipped');
            gameState.flippedCards.push(card);

            // Check for match when 2 cards are flipped
            if (gameState.flippedCards.length === 2) {
                gameState.moves++;
                document.getElementById('moveCount').textContent = gameState.moves;
                gameState.canFlip = false;

                setTimeout(checkForMatch, 800);
            }
        }

        function checkForMatch() {
            const [card1, card2] = gameState.flippedCards;

            if (card1.imageIndex === card2.imageIndex) {
                // Match found!
                card1.isMatched = true;
                card2.isMatched = true;

                const card1Element = document.querySelector(`[data-card-id="${card1.id}"]`);
                const card2Element = document.querySelector(`[data-card-id="${card2.id}"]`);
                card1Element.classList.add('matched');
                card2Element.classList.add('matched');

                gameState.matchedPairs++;
                document.getElementById('matchCount').textContent = gameState.matchedPairs;

                // Check for win
                const totalPairs = gameState.cards.length / 2;
                if (gameState.matchedPairs === totalPairs) {
                    setTimeout(showWinMessage, 500);
                }

                gameState.flippedCards = [];
                gameState.canFlip = true;
            } else {
                // No match - flip back
                setTimeout(() => {
                    card1.isFlipped = false;
                    card2.isFlipped = false;

                    const card1Element = document.querySelector(`[data-card-id="${card1.id}"]`);
                    const card2Element = document.querySelector(`[data-card-id="${card2.id}"]`);
                    card1Element.classList.remove('flipped');
                    card2Element.classList.remove('flipped');

                    gameState.flippedCards = [];
                    gameState.canFlip = true;
                }, 600);
            }
        }

        function showWinMessage() {
            document.getElementById('finalMoves').textContent = gameState.moves;
            document.getElementById('winMessage').classList.add('show');
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        window.addEventListener('load', function() {
            loadFavorites();
            updateFavoritesGallery();

            setTimeout(() => {
                document.getElementById('monkeyType').value = 'japanese macaque';
                loadMonkeyImage(false, false); // Don't auto-clear on initial load
            }, 500);

            // Initialize memory game
            console.log('Initializing memory game...');
            initMemoryGame();
            console.log('Memory game initialized!');
        });
    </script>
</body>
</html>
